import { useState, useEffect } from "react";
import { PieChart, Pie, Cell, Legend, Tooltip } from "recharts";

function VulnerabilityPieChart() {
  const [vulnerabilityCounts, setVulnerabilityCounts] = useState([]);

  useEffect(() => {
    async function fetchData() {
      try {
        const response = await fetch("/api/vulnerability_count");
        const data = await response.json();
        const counts = Object.entries(data.counts).map(([name, value]) => ({
          name,
          value,
        }));
        setVulnerabilityCounts(counts);
      } catch (error) {
        console.error("Error fetching vulnerability counts:", error);
      }
    }
    fetchData();
  }, []);

  const COLORS = [
    "#0088FE",
    "#00C49F",
    "#FFBB28",
    "#FF8042",
    "#FF00FF",
  ];

  return (
    <PieChart width={400} height={400}>
      <Pie
        data={vulnerabilityCounts}
        dataKey="value"
        nameKey="name"
        cx="50%"
        cy="50%"
        outerRadius={100}
        fill="#8884d8"
      >
        {vulnerabilityCounts.map((entry, index) => (
          <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />
        ))}
      </Pie>
      <Tooltip />
      <Legend />
    </PieChart>
  );
}

export default VulnerabilityPieChart;
